import{_ as H,a as k,n as W,i as M,b as A,t as z,f as J,c as L,d as N,s as X,e as Y,h as Q,S as ee,R as b,k as F,p as te,j as v,r as re,L as se}from"./index-4S4BaL8q.js";import{s as ne,b as S,k as V,u as $,g as ie,G as x}from"./iconBase-QcKY8ROS.js";var ae=function(s){H(a,s);function a(i,t){var e;return e=s.call(this)||this,e.client=i,e.options=t,e.trackedProps=[],e.selectError=null,e.bindMethods(),e.setOptions(t),e}var r=a.prototype;return r.bindMethods=function(){this.remove=this.remove.bind(this),this.refetch=this.refetch.bind(this)},r.onSubscribe=function(){this.listeners.length===1&&(this.currentQuery.addObserver(this),G(this.currentQuery,this.options)&&this.executeFetch(),this.updateTimers())},r.onUnsubscribe=function(){this.listeners.length||this.destroy()},r.shouldFetchOnReconnect=function(){return O(this.currentQuery,this.options,this.options.refetchOnReconnect)},r.shouldFetchOnWindowFocus=function(){return O(this.currentQuery,this.options,this.options.refetchOnWindowFocus)},r.destroy=function(){this.listeners=[],this.clearTimers(),this.currentQuery.removeObserver(this)},r.setOptions=function(t,e){var u=this.options,n=this.currentQuery;if(this.options=this.client.defaultQueryObserverOptions(t),typeof this.options.enabled<"u"&&typeof this.options.enabled!="boolean")throw new Error("Expected enabled to be a boolean");this.options.queryKey||(this.options.queryKey=u.queryKey),this.updateQuery();var l=this.hasListeners();l&&D(this.currentQuery,n,this.options,u)&&this.executeFetch(),this.updateResult(e),l&&(this.currentQuery!==n||this.options.enabled!==u.enabled||this.options.staleTime!==u.staleTime)&&this.updateStaleTimeout();var o=this.computeRefetchInterval();l&&(this.currentQuery!==n||this.options.enabled!==u.enabled||o!==this.currentRefetchInterval)&&this.updateRefetchInterval(o)},r.getOptimisticResult=function(t){var e=this.client.defaultQueryObserverOptions(t),u=this.client.getQueryCache().build(this.client,e);return this.createResult(u,e)},r.getCurrentResult=function(){return this.currentResult},r.trackResult=function(t,e){var u=this,n={},l=function(d){u.trackedProps.includes(d)||u.trackedProps.push(d)};return Object.keys(t).forEach(function(o){Object.defineProperty(n,o,{configurable:!1,enumerable:!0,get:function(){return l(o),t[o]}})}),(e.useErrorBoundary||e.suspense)&&l("error"),n},r.getNextResult=function(t){var e=this;return new Promise(function(u,n){var l=e.subscribe(function(o){o.isFetching||(l(),o.isError&&(t!=null&&t.throwOnError)?n(o.error):u(o))})})},r.getCurrentQuery=function(){return this.currentQuery},r.remove=function(){this.client.getQueryCache().remove(this.currentQuery)},r.refetch=function(t){return this.fetch(k({},t,{meta:{refetchPage:t==null?void 0:t.refetchPage}}))},r.fetchOptimistic=function(t){var e=this,u=this.client.defaultQueryObserverOptions(t),n=this.client.getQueryCache().build(this.client,u);return n.fetch().then(function(){return e.createResult(n,u)})},r.fetch=function(t){var e=this;return this.executeFetch(t).then(function(){return e.updateResult(),e.currentResult})},r.executeFetch=function(t){this.updateQuery();var e=this.currentQuery.fetch(this.options,t);return t!=null&&t.throwOnError||(e=e.catch(W)),e},r.updateStaleTimeout=function(){var t=this;if(this.clearStaleTimeout(),!(M||this.currentResult.isStale||!A(this.options.staleTime))){var e=z(this.currentResult.dataUpdatedAt,this.options.staleTime),u=e+1;this.staleTimeoutId=setTimeout(function(){t.currentResult.isStale||t.updateResult()},u)}},r.computeRefetchInterval=function(){var t;return typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.currentResult.data,this.currentQuery):(t=this.options.refetchInterval)!=null?t:!1},r.updateRefetchInterval=function(t){var e=this;this.clearRefetchInterval(),this.currentRefetchInterval=t,!(M||this.options.enabled===!1||!A(this.currentRefetchInterval)||this.currentRefetchInterval===0)&&(this.refetchIntervalId=setInterval(function(){(e.options.refetchIntervalInBackground||J.isFocused())&&e.executeFetch()},this.currentRefetchInterval))},r.updateTimers=function(){this.updateStaleTimeout(),this.updateRefetchInterval(this.computeRefetchInterval())},r.clearTimers=function(){this.clearStaleTimeout(),this.clearRefetchInterval()},r.clearStaleTimeout=function(){this.staleTimeoutId&&(clearTimeout(this.staleTimeoutId),this.staleTimeoutId=void 0)},r.clearRefetchInterval=function(){this.refetchIntervalId&&(clearInterval(this.refetchIntervalId),this.refetchIntervalId=void 0)},r.createResult=function(t,e){var u=this.currentQuery,n=this.options,l=this.currentResult,o=this.currentResultState,d=this.currentResultOptions,c=t!==u,f=c?t.state:this.currentQueryInitialState,y=c?this.currentResult:this.previousQueryResult,h=t.state,C=h.dataUpdatedAt,T=h.error,U=h.errorUpdatedAt,I=h.isFetching,p=h.status,P=!1,j=!1,g;if(e.optimisticResults){var B=this.hasListeners(),Z=!B&&G(t,e),K=B&&D(t,u,e,n);(Z||K)&&(I=!0,C||(p="loading"))}if(e.keepPreviousData&&!h.dataUpdateCount&&(y!=null&&y.isSuccess)&&p!=="error")g=y.data,C=y.dataUpdatedAt,p=y.status,P=!0;else if(e.select&&typeof h.data<"u")if(l&&h.data===(o==null?void 0:o.data)&&e.select===this.selectFn)g=this.selectResult;else try{this.selectFn=e.select,g=e.select(h.data),e.structuralSharing!==!1&&(g=L(l==null?void 0:l.data,g)),this.selectResult=g,this.selectError=null}catch(E){N().error(E),this.selectError=E}else g=h.data;if(typeof e.placeholderData<"u"&&typeof g>"u"&&(p==="loading"||p==="idle")){var m;if(l!=null&&l.isPlaceholderData&&e.placeholderData===(d==null?void 0:d.placeholderData))m=l.data;else if(m=typeof e.placeholderData=="function"?e.placeholderData():e.placeholderData,e.select&&typeof m<"u")try{m=e.select(m),e.structuralSharing!==!1&&(m=L(l==null?void 0:l.data,m)),this.selectError=null}catch(E){N().error(E),this.selectError=E}typeof m<"u"&&(p="success",g=m,j=!0)}this.selectError&&(T=this.selectError,g=this.selectResult,U=Date.now(),p="error");var q={status:p,isLoading:p==="loading",isSuccess:p==="success",isError:p==="error",isIdle:p==="idle",data:g,dataUpdatedAt:C,error:T,errorUpdatedAt:U,failureCount:h.fetchFailureCount,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>f.dataUpdateCount||h.errorUpdateCount>f.errorUpdateCount,isFetching:I,isRefetching:I&&p!=="loading",isLoadingError:p==="error"&&h.dataUpdatedAt===0,isPlaceholderData:j,isPreviousData:P,isRefetchError:p==="error"&&h.dataUpdatedAt!==0,isStale:w(t,e),refetch:this.refetch,remove:this.remove};return q},r.shouldNotifyListeners=function(t,e){if(!e)return!0;var u=this.options,n=u.notifyOnChangeProps,l=u.notifyOnChangePropsExclusions;if(!n&&!l||n==="tracked"&&!this.trackedProps.length)return!0;var o=n==="tracked"?this.trackedProps:n;return Object.keys(t).some(function(d){var c=d,f=t[c]!==e[c],y=o==null?void 0:o.some(function(C){return C===d}),h=l==null?void 0:l.some(function(C){return C===d});return f&&!h&&(!o||y)})},r.updateResult=function(t){var e=this.currentResult;if(this.currentResult=this.createResult(this.currentQuery,this.options),this.currentResultState=this.currentQuery.state,this.currentResultOptions=this.options,!X(this.currentResult,e)){var u={cache:!0};(t==null?void 0:t.listeners)!==!1&&this.shouldNotifyListeners(this.currentResult,e)&&(u.listeners=!0),this.notify(k({},u,t))}},r.updateQuery=function(){var t=this.client.getQueryCache().build(this.client,this.options);if(t!==this.currentQuery){var e=this.currentQuery;this.currentQuery=t,this.currentQueryInitialState=t.state,this.previousQueryResult=this.currentResult,this.hasListeners()&&(e==null||e.removeObserver(this),t.addObserver(this))}},r.onQueryUpdate=function(t){var e={};t.type==="success"?e.onSuccess=!0:t.type==="error"&&!Y(t.error)&&(e.onError=!0),this.updateResult(e),this.hasListeners()&&this.updateTimers()},r.notify=function(t){var e=this;Q.batch(function(){t.onSuccess?(e.options.onSuccess==null||e.options.onSuccess(e.currentResult.data),e.options.onSettled==null||e.options.onSettled(e.currentResult.data,null)):t.onError&&(e.options.onError==null||e.options.onError(e.currentResult.error),e.options.onSettled==null||e.options.onSettled(void 0,e.currentResult.error)),t.listeners&&e.listeners.forEach(function(u){u(e.currentResult)}),t.cache&&e.client.getQueryCache().notify({query:e.currentQuery,type:"observerResultsUpdated"})})},a}(ee);function ue(s,a){return a.enabled!==!1&&!s.state.dataUpdatedAt&&!(s.state.status==="error"&&a.retryOnMount===!1)}function G(s,a){return ue(s,a)||s.state.dataUpdatedAt>0&&O(s,a,a.refetchOnMount)}function O(s,a,r){if(a.enabled!==!1){var i=typeof r=="function"?r(s):r;return i==="always"||i!==!1&&w(s,a)}return!1}function D(s,a,r,i){return r.enabled!==!1&&(s!==a||i.enabled===!1)&&(!r.suspense||s.state.status!=="error")&&w(s,r)}function w(s,a){return s.isStaleByTime(a.staleTime)}function oe(){var s=!1;return{clearReset:function(){s=!1},reset:function(){s=!0},isReset:function(){return s}}}var ce=b.createContext(oe()),le=function(){return b.useContext(ce)};function he(s,a){var r=b.useRef(!1),i=b.useState(0),t=i[1],e=F(),u=le(),n=e.defaultQueryObserverOptions(s);n.optimisticResults=!0,n.onError&&(n.onError=Q.batchCalls(n.onError)),n.onSuccess&&(n.onSuccess=Q.batchCalls(n.onSuccess)),n.onSettled&&(n.onSettled=Q.batchCalls(n.onSettled)),n.suspense&&(typeof n.staleTime!="number"&&(n.staleTime=1e3),n.cacheTime===0&&(n.cacheTime=1)),(n.suspense||n.useErrorBoundary)&&(u.isReset()||(n.retryOnMount=!1));var l=b.useState(function(){return new a(e,n)}),o=l[0],d=o.getOptimisticResult(n);if(b.useEffect(function(){r.current=!0,u.clearReset();var c=o.subscribe(Q.batchCalls(function(){r.current&&t(function(f){return f+1})}));return o.updateResult(),function(){r.current=!1,c()}},[u,o]),b.useEffect(function(){o.setOptions(n,{listeners:!1})},[n,o]),n.suspense&&d.isLoading)throw o.fetchOptimistic(n).then(function(c){var f=c.data;n.onSuccess==null||n.onSuccess(f),n.onSettled==null||n.onSettled(f,null)}).catch(function(c){u.clearReset(),n.onError==null||n.onError(c),n.onSettled==null||n.onSettled(void 0,c)});if(d.isError&&!u.isReset()&&!d.isFetching&&ne(n.suspense,n.useErrorBoundary,[d.error,o.getCurrentQuery()]))throw d.error;return n.notifyOnChangeProps==="tracked"&&(d=o.trackResult(d,n)),d}function _(s,a,r){var i=te(s,a,r);return he(i,ae)}const de=async(s,a)=>{try{return await S.post("/votes",{image_id:s,value:a})}catch{throw new Error("Error voting on cat")}},fe=async()=>{try{const s=await S.get("/votes");return V(s.data)}catch{throw new Error("Error fetching cat votes")}},ve=()=>{const s=F();return $(({imageId:a,value:r})=>de(a,r),{onSuccess:()=>{s.invalidateQueries("catVotes")}})},pe=()=>_("catVotes",fe),ye=async()=>{try{const s=await S.get("/favourites");return V(s.data)}catch{throw new Error("Error fetching favourite cats")}},ge=async(s,a)=>{if(a)try{return await S.delete(`/favourites/${a}`)}catch{throw new Error("Error removing favorite cat")}else try{return await S.post("/favourites",{image_id:s})}catch{throw new Error("Error adding favorite cat")}},me=()=>{const s=F();return $(({imageId:a,favouriteId:r})=>ge(a,r),{onSuccess:()=>{s.invalidateQueries("catFavourites")}})},Re=()=>_("catFavourites",ye),Ce=({limit:s,page:a,order:r}={})=>_(["myUploadedCats",s,a,r],()=>ie({limit:s,page:a,order:r})),be="_card_11xcx_1",Ee="_imageContainer_11xcx_11",Qe="_catImage_11xcx_19",Se="_actions_11xcx_26",xe="_favouriteButton_11xcx_42",Ie="_votingContainer_11xcx_46",R={card:be,imageContainer:Ee,catImage:Qe,actions:Se,favouriteButton:xe,votingContainer:Ie};function Oe(s){return x({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4.97 13.22a.75.75 0 0 1 1.06 0L11 18.19V3.75a.75.75 0 0 1 1.5 0v14.44l4.97-4.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734l-6.25 6.25a.75.75 0 0 1-1.06 0l-6.25-6.25a.75.75 0 0 1 0-1.06Z"}}]})(s)}function Fe(s){return x({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M18.655 10.405a.75.75 0 0 1-1.06 0l-4.97-4.97v14.44a.75.75 0 0 1-1.5 0V5.435l-4.97 4.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734l6.25-6.25a.75.75 0 0 1 1.06 0l6.25 6.25a.75.75 0 0 1 0 1.06Z"}}]})(s)}function we(s){return x({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m12 20.703.343.667a.748.748 0 0 1-.686 0l-.003-.002-.007-.003-.025-.013a31.138 31.138 0 0 1-5.233-3.576C3.8 15.573 1 12.332 1 8.514v-.001C1 5.053 3.829 2.5 6.736 2.5 9.03 2.5 10.881 3.726 12 5.605 13.12 3.726 14.97 2.5 17.264 2.5 20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262a31.148 31.148 0 0 1-5.233 3.576l-.025.013-.007.003-.002.001ZM6.736 4C4.657 4 2.5 5.88 2.5 8.514c0 3.107 2.324 5.96 4.861 8.12a29.655 29.655 0 0 0 4.566 3.175l.073.041.073-.04c.271-.153.661-.38 1.13-.674.94-.588 2.19-1.441 3.436-2.502 2.537-2.16 4.861-5.013 4.861-8.12C21.5 5.88 19.343 4 17.264 4c-2.106 0-3.801 1.389-4.553 3.643a.751.751 0 0 1-1.422 0C10.537 5.389 8.841 4 6.736 4Z"}}]})(s)}function _e(s){return x({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M14 20.408c-.492.308-.903.546-1.192.709-.153.086-.308.17-.463.252h-.002a.75.75 0 0 1-.686 0 16.709 16.709 0 0 1-.465-.252 31.147 31.147 0 0 1-4.803-3.34C3.8 15.572 1 12.331 1 8.513 1 5.052 3.829 2.5 6.736 2.5 9.03 2.5 10.881 3.726 12 5.605 13.12 3.726 14.97 2.5 17.264 2.5 20.17 2.5 23 5.052 23 8.514c0 3.818-2.801 7.06-5.389 9.262A31.146 31.146 0 0 1 14 20.408Z"}}]})(s)}const Te=({cat:s,score:a,onUpvote:r,onDownvote:i,onToggleFavourite:t,favouriteId:e})=>{const u=e!=null;return v.jsxs("div",{className:R.card,children:[v.jsx("div",{className:R.imageContainer,children:v.jsx("img",{src:s.url,alt:s.originalFilename,className:R.catImage})}),v.jsxs("div",{className:R.actions,children:[v.jsx("button",{onClick:t,className:R.favouriteButton,children:u?v.jsx(_e,{}):v.jsx(we,{})}),v.jsxs("div",{className:R.votingContainer,children:[v.jsx("button",{onClick:r,className:R.upvoteButton,children:v.jsx(Fe,{})}),v.jsx("p",{className:R.score,children:a}),v.jsx("button",{onClick:i,className:R.downvoteButton,children:v.jsx(Oe,{})})]})]})]})},Ue="_catGallery_1ah8u_1",Pe={catGallery:Ue},ke=()=>{const{data:s,isLoading:a,error:r}=Ce(),{data:i}=pe(),{data:t}=Re(),{mutate:e}=ve(),{mutate:u}=me(),n=c=>{e({imageId:c,value:1})},l=c=>{e({imageId:c,value:-1})},o=(c,f)=>{u({imageId:c,favouriteId:f})},d=re.useMemo(()=>{const c={};return i==null||i.forEach(f=>{c[f.imageId]=(c[f.imageId]||0)+f.value}),c},[i]);return a?v.jsx(se,{}):r?v.jsxs("div",{children:["Error: ",r.message]}):v.jsx("div",{className:Pe.catGallery,children:s==null?void 0:s.map(c=>{var f;return v.jsx(Te,{cat:c,score:d[c.id]||0,favouriteId:(f=t==null?void 0:t.find(y=>y.imageId===c.id))==null?void 0:f.id,onUpvote:()=>n(c.id),onDownvote:()=>l(c.id),onToggleFavourite:()=>{var y;return o(c.id,(y=t==null?void 0:t.find(h=>h.imageId===c.id))==null?void 0:y.id)}},c.id)})})};export{ke as HomePage};
